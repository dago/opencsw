#!/bin/bash
#
# $Id$
#
# Copyright 2006 Cory Omand <comand@blastwave.org>
# All rights reserved.  Use is subject to license terms.
#
# Redistribution and/or use, with or without modification, is
# permitted.  This software is without warranty of any kind.  The
# author(s) shall not be liable in the event that use of the
# software causes damage.
#
# replacer - replace or remove references to the specified directory.
#

ROOTDIR=${1:-'.'}

for file in `find $ROOTDIR -type f | xargs grep -l $ROOTDIR`
do
    if [ ! -z "`file $file | egrep 'ELF|ar archive'`" ] ||
       [ ! -z "`echo $file | egrep '.bak'`" ]; then
        continue
    fi
    /bin/perl -i -plne "
        s#-[ILR]\s*$ROOTDIR\S+\s+##;
        s#$ROOTDIR/#/#;
    " $file
done
