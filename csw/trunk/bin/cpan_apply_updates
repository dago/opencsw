#!/bin/perl -w

use strict;

while (<>) {
    my ($module, $newvers) = split /\|/, $_;
    next unless $module && $newvers;

    unless (-d $module) {
        print "Cannot find module directory: $module\n";
        next;
    }
    print "Updating $module to $newvers\n";
    my $rpat = "s/^(GARVERSION).*\$/\$1 = $newvers/";
    system("perl -i.bak -plne '$rpat' $module/Makefile")
        and die "Failed to upgrade $module\n";
    system("gmake -C $module update")
        and die "Failed to execute update target on $module\n";
}
