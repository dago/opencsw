# test the package root dir
if [ "$PKG_ROOT_DIR" = "" ] ; then
        PKG_ROOT_DIR="$PKG_INSTALL_ROOT"
fi
# if $PKG_ROOT_DIR is empty then there is no need to set it to / since the loop add it

# Test if the confiuration file exists. If it does not, then copy the template
# provided with this package. If it exists, then the script notify the user

for i in `find $PKG_ROOT_DIR/opt/csw/share/tomcat5/conf/ -type file -name "*.CSW"` ; 
        do newFile=`echo $i | sed -e 's/\.CSW/ /g'` ;
        if [ ! -f $newFile ]
        then
                cp -p $i $newFile ;
        else
		eval diff $i $newFile > /dev/null
		if test $? -eq 1
		then
                	echo File $newFile already exist and is different from the file included in the package. 
			echo The latest file is available in $i
			echo
		fi
        fi
done

# Read the global configuration file
if [ -x $PKG_INSTALL_ROOT/opt/csw/etc/csw.conf ] ; then
	. $PKG_INSTALL_ROOT/opt/csw/etc/csw.conf
fi

if [ -x $PKG_INSTALL_ROOT/etc/opt/csw/csw.conf ] ; then
	. $PKG_INSTALL_ROOT/etc/opt/csw/csw.conf
fi

# Start the server if needed 
if [ ! "$autoenable_tomcat5" = "no" ] ; then
	if [ "$autoenable_tomcat5" = "yes" ] ; then
    		/etc/init.d/cswtomcat5 start
	else
    		if [ "$autoenable_daemons" = "yes" ] ; then
    			/etc/init.d/cswtomcat5 start
  		fi
  	fi
fi

