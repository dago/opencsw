From cbb45c1b56535bd8782be19ae67d68cba29fe9f4 Mon Sep 17 00:00:00 2001
From: Mark Phillips <none@none>
Date: Fri, 8 Jul 2011 14:41:08 +0200
Subject: [PATCH] puppetlabs ticket 7038 to fix prtdiag

---
 lib/facter.rb                   |    2 +-
 lib/facter/util/manufacturer.rb |    7 ++++---
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/lib/facter.rb b/lib/facter.rb
index eed32f8..2073b84 100644
--- a/lib/facter.rb
+++ b/lib/facter.rb
@@ -24,7 +24,7 @@ module Facter
     include Comparable
     include Enumerable
 
-    FACTERVERSION = '1.6.0'
+    FACTERVERSION = '1.5.9'
     # = Facter
     # Functions as a hash of 'facts' you might care about about your
     # system, such as mac address, IP address, Video card, etc.
diff --git a/lib/facter/util/manufacturer.rb b/lib/facter/util/manufacturer.rb
index 8e9bde2..33389c9 100644
--- a/lib/facter/util/manufacturer.rb
+++ b/lib/facter/util/manufacturer.rb
@@ -1,6 +1,8 @@
 # mamufacturer.rb
 # Support methods for manufacturer specific facts
 
+require 'facter/util/prtdiag'
+
 module Facter::Manufacturer
 
     def self.get_dmi_table()
@@ -62,11 +64,10 @@ module Facter::Manufacturer
     end
 
     def self.prtdiag_sparc_find_system_info()
-        # Parses prtdiag for a SPARC architecture string, won't work with Solaris x86
-        output = Facter::Util::Resolution.exec('/usr/sbin/prtdiag')
 
+        # Parses prtdiag for a SPARC architecture string, won't work with Solaris x86
         # System Configuration:  Sun Microsystems  sun4u Sun SPARC Enterprise M3000 Server
-        sysconfig = output.split("\n")[0]
+        sysconfig = Facter::Util::Prtdiag.system_configuration
         if sysconfig =~ /^System Configuration:\s+(.+?)\s+(sun\d+\S+)\s+(.+)/ then
             Facter.add('manufacturer') do
                 setcode do
-- 
1.7.6

