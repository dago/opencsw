diff --speed-large-files --minimal -Nru munin-1.4.0.orig/Makefile munin-1.4.0/Makefile
--- munin-1.4.0.orig/Makefile	2009-11-27 12:17:18.000000000 +0100
+++ munin-1.4.0/Makefile	2009-11-28 18:13:47.250778081 +0100
@@ -49,8 +49,8 @@
 # This removes the installed config so that the next install-pass installs
 # a new config.  Target _only_ suitable for maintainers.
 unconfig:
-	rm -f $(HTMLDIR)/.htaccess
-	rm -f $(CONFDIR)/munin.conf
+	rm -f $(DESTDIR)$(HTMLDIR)/.htaccess
+	rm -f $(DESTDIR)$(CONFDIR)/munin.conf
 
 tags:
 	-rm -f TAGS
@@ -66,50 +66,47 @@
 
 install-pre: Makefile Makefile.config
 	@$(CHECKUSER)
-	mkdir -p $(LOGDIR)
-	mkdir -p $(STATEDIR)
-	mkdir -p $(CONFDIR)
-	$(CHOWN) $(USER) $(LOGDIR) $(STATEDIR)
+	mkdir -p $(DESTDIR)$(LOGDIR)
+	mkdir -p $(DESTDIR)$(STATEDIR)
+	mkdir -p $(DESTDIR)$(CONFDIR)
 
 install-master-prime: $(INFILES_MASTER) install-pre install-master
-	mkdir -p $(CONFDIR)/templates
-	mkdir -p $(CONFDIR)/templates/partial
-	mkdir -p $(CONFDIR)/munin-conf.d
-	mkdir -p $(LIBDIR)
-	mkdir -p $(BINDIR)
-	mkdir -p $(PERLLIB)
-	mkdir -p $(PERLLIB)/Munin/Master
-	mkdir -p $(HTMLDIR)
-	mkdir -p $(DBDIR)
-	mkdir -p $(CGIDIR)
-
-	$(CHOWN) $(USER) $(HTMLDIR) $(DBDIR) 
+	mkdir -p $(DESTDIR)$(CONFDIR)/templates
+	mkdir -p $(DESTDIR)$(CONFDIR)/templates/partial
+	mkdir -p $(DESTDIR)$(CONFDIR)/munin-conf.d
+	mkdir -p $(DESTDIR)$(LIBDIR)
+	mkdir -p $(DESTDIR)$(BINDIR)
+	mkdir -p $(DESTDIR)$(PERLLIB)
+	mkdir -p $(DESTDIR)$(PERLLIB)/Munin/Master
+	mkdir -p $(DESTDIR)$(HTMLDIR)
+	mkdir -p $(DESTDIR)$(DBDIR)
+	mkdir -p $(DESTDIR)$(CGIDIR)
 
 	for p in master/www/*.tmpl master/www/*.png master/www/*.css resources/favicon.ico; do \
-		$(INSTALL) -m 0644 "$$p" $(CONFDIR)/templates/ ; \
+		$(INSTALL) -m 0644 "$$p" $(DESTDIR)$(CONFDIR)/templates/ ; \
 	done
 
 	for p in master/www/partial/*.tmpl; do \
-		$(INSTALL) -m 0644 "$$p" $(CONFDIR)/templates/partial/ ; \
+		$(INSTALL) -m 0644 "$$p" $(DESTDIR)$(CONFDIR)/templates/partial/ ; \
 	done
 
-	$(INSTALL) -m 0644 master/www/definitions.html $(CONFDIR)/templates/
-	$(INSTALL) -m 0755 master/VeraMono.ttf $(LIBDIR)/
+	$(INSTALL) -m 0644 master/www/definitions.html $(DESTDIR)$(CONFDIR)/templates/
+	$(INSTALL) -m 0755 master/VeraMono.ttf $(DESTDIR)$(LIBDIR)/
 
-	test -f $(HTMLDIR)/.htaccess || $(INSTALL) -m 0644 build/master/www/munin-htaccess $(HTMLDIR)/.htaccess
-	test -f "$(CONFDIR)/munin.conf"  || $(INSTALL) -m 0644 build/master/munin.conf $(CONFDIR)/
+	test -f $(DESTDIR)$(HTMLDIR)/.htaccess || $(INSTALL) -m 0644 build/master/www/munin-htaccess $(DESTDIR)$(HTMLDIR)/.htaccess
+	test -f "$(DESTDIR)$(CONFDIR)/munin.conf"  || $(INSTALL) -m 0644 build/master/munin.conf $(DESTDIR)$(CONFDIR)/
 
-	$(INSTALL) -m 0755 build/master/_bin/munin-cron $(BINDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-check $(BINDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-update $(LIBDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-graph $(LIBDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-html $(LIBDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-limits $(LIBDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-cgi-graph $(CGIDIR)/
-	$(INSTALL) -m 0755 build/master/_bin/munin-fastcgi-graph $(CGIDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-cron $(DESTDIR)$(BINDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-check $(DESTDIR)$(BINDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-update $(DESTDIR)$(LIBDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-graph $(DESTDIR)$(LIBDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-html $(DESTDIR)$(LIBDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-limits $(DESTDIR)$(LIBDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-cgi-graph $(DESTDIR)$(CGIDIR)/
+	$(INSTALL) -m 0755 build/master/_bin/munin-fastcgi-graph $(DESTDIR)$(CGIDIR)/
 
 # Not ready to be installed yet	
-# $(INSTALL) -m 0755 build/master/_bin/munin-gather $(LIBDIR)/
+# $(INSTALL) -m 0755 build/master/_bin/munin-gather $(DESTDIR)$(LIBDIR)/
 
 # ALWAYS DO THE OS SPECIFIC PLUGINS LAST! THAT WAY THEY OVERWRITE THE
 # GENERIC ONES
@@ -120,28 +117,24 @@
 install-plugins-prime: install-plugins build $(PLUGINS) Makefile Makefile.config
 	@$(CHECKGROUP)
 
-	mkdir -p $(CONFDIR)/plugins
-	mkdir -p $(CONFDIR)/plugin-conf.d
-	mkdir -p $(LIBDIR)/plugins
+	mkdir -p $(DESTDIR)$(CONFDIR)/plugins
+	mkdir -p $(DESTDIR)$(CONFDIR)/plugin-conf.d
+	mkdir -p $(DESTDIR)$(LIBDIR)/plugins
 	mkdir -p $(PLUGSTATE)
 
-	$(CHOWN) $(PLUGINUSER):$(GROUP) $(PLUGSTATE)
-	$(CHMOD) 0775 $(PLUGSTATE)
-	$(CHMOD) 0755 $(CONFDIR)/plugin-conf.d
-
 	for p in build/plugins/node.d/* build/plugins/node.d.$(OSTYPE)/* ; do \
 	    if test -f "$$p" ; then                            \
 		echo Installing $$p;                           \
-		$(INSTALL) -m 0755 $$p $(LIBDIR)/plugins/;     \
+		$(INSTALL) -m 0755 $$p $(DESTDIR)$(LIBDIR)/plugins/;     \
 	    fi                                                 \
 	done
-	-mv $(LIBDIR)/plugins/*.adv $(LIBDIR)
-	$(INSTALL) -m 0644 build/plugins/plugins.history $(LIBDIR)/plugins/
-	$(INSTALL) -m 0644 build/plugins/plugin.sh $(LIBDIR)/plugins/
+	-mv $(DESTDIR)$(LIBDIR)/plugins/*.adv $(DESTDIR)$(LIBDIR)
+	$(INSTALL) -m 0644 build/plugins/plugins.history $(DESTDIR)$(LIBDIR)/plugins/
+	$(INSTALL) -m 0644 build/plugins/plugin.sh $(DESTDIR)$(LIBDIR)/plugins/
 
 install-plugins-java: build-plugins-java
-	mkdir -p $(JAVALIBDIR)
-	$(INSTALL) -m 0644 build/plugins/javalib/munin-jmx-plugins.jar $(JAVALIBDIR)/
+	mkdir -p $(DESTDIR)$(JAVALIBDIR)
+	$(INSTALL) -m 0644 build/plugins/javalib/munin-jmx-plugins.jar $(DESTDIR)$(JAVALIBDIR)/
 
 #TODO:
 # configure plugins.  Or not. Better done under the direction of the installer
@@ -150,30 +143,30 @@
 install-node-prime: install-node-pre install-node
 
 install-node-pre: build/node/munin-node.conf install-pre
-	test -f "$(CONFDIR)/munin-node.conf" || $(INSTALL) -m 0644 build/node/munin-node.conf $(CONFDIR)/
+	test -f "$(DESTDIR)$(CONFDIR)/munin-node.conf" || $(INSTALL) -m 0644 build/node/munin-node.conf $(DESTDIR)$(CONFDIR)/
 
 
 install-common-prime: build-common install-common
 
 
 install-man: build-man Makefile Makefile.config
-	mkdir -p $(MANDIR)/man1 $(MANDIR)/man5 $(MANDIR)/man8
-	$(INSTALL) -m 0644 build/doc/munin-node.conf.5 $(MANDIR)/man5/
-	$(INSTALL) -m 0644 build/doc/munin.conf.5 $(MANDIR)/man5/
-	$(INSTALL) -m 0644 build/doc/munin-graph.8 $(MANDIR)/man8/
-	$(INSTALL) -m 0644 build/doc/munin-update.8 $(MANDIR)/man8/
-	$(INSTALL) -m 0644 build/doc/munin-limits.8 $(MANDIR)/man8/
-	$(INSTALL) -m 0644 build/doc/munin-html.8 $(MANDIR)/man8/
-	$(INSTALL) -m 0644 build/doc/munin-cron.8 $(MANDIR)/man8/
-	$(INSTALL) -m 0644 build/doc/munin-check.8 $(MANDIR)/man8/
-	$(INSTALL) -m 0644 build/doc/munin.8 $(MANDIR)/man8/
+	mkdir -p $(DESTDIR)$(MANDIR)/man1 $(DESTDIR)$(MANDIR)/man5 $(DESTDIR)$(MANDIR)/man8
+	$(INSTALL) -m 0644 build/doc/munin-node.conf.5 $(DESTDIR)$(MANDIR)/man5/
+	$(INSTALL) -m 0644 build/doc/munin.conf.5 $(DESTDIR)$(MANDIR)/man5/
+	$(INSTALL) -m 0644 build/doc/munin-graph.8 $(DESTDIR)$(MANDIR)/man8/
+	$(INSTALL) -m 0644 build/doc/munin-update.8 $(DESTDIR)$(MANDIR)/man8/
+	$(INSTALL) -m 0644 build/doc/munin-limits.8 $(DESTDIR)$(MANDIR)/man8/
+	$(INSTALL) -m 0644 build/doc/munin-html.8 $(DESTDIR)$(MANDIR)/man8/
+	$(INSTALL) -m 0644 build/doc/munin-cron.8 $(DESTDIR)$(MANDIR)/man8/
+	$(INSTALL) -m 0644 build/doc/munin-check.8 $(DESTDIR)$(MANDIR)/man8/
+	$(INSTALL) -m 0644 build/doc/munin.8 $(DESTDIR)$(MANDIR)/man8/
 
 
 install-doc: build-doc
-	mkdir -p $(DOCDIR)/resources
-	$(INSTALL) -m 0644 README $(DOCDIR)/
-	$(INSTALL) -m 0644 COPYING $(DOCDIR)/
-	$(INSTALL) -m 0644 build/resources/* $(DOCDIR)/resources
+	mkdir -p $(DESTDIR)$(DOCDIR)/resources
+	$(INSTALL) -m 0644 README $(DESTDIR)$(DOCDIR)/
+	$(INSTALL) -m 0644 COPYING $(DESTDIR)$(DOCDIR)/
+	$(INSTALL) -m 0644 build/resources/* $(DESTDIR)$(DOCDIR)/resources
 
 ######################################################################
 
@@ -370,20 +363,20 @@
 	$(MAKE) $@ CONFIG=t/Makefile.config
 else
 test_plugins = id_default id_root env
-old-test: t/*.t t/install $(addprefix $(CONFDIR)/plugins/,$(test_plugins))
+old-test: t/*.t t/install $(addprefix $(DESTDIR)$(CONFDIR)/plugins/,$(test_plugins))
 	@for test in t/*.t; do \
 		echo -n "$$test: "; \
-		PERL5LIB=$(PERLLIB) $(PERL) $$test;\
+		PERL5LIB=$(DESTDIR)$(PERLLIB) $(PERL) $$test;\
 	done
 endif
 
 node-monkeywrench: install-node
-	rm -rf $(CONFDIR)/plugins
-	rm -rf $(LIBDIR)/plugins
-	mkdir -p $(LIBDIR)/plugins
-	mkdir -p $(CONFDIR)/plugins
-	cp monkeywrench/plugin-break*_ $(LIBDIR)/plugins/
-	$(SBINDIR)/munin-node-configure --suggest
+	rm -rf $(DESTDIR)$(CONFDIR)/plugins
+	rm -rf $(DESTDIR)$(LIBDIR)/plugins
+	mkdir -p $(DESTDIR)$(LIBDIR)/plugins
+	mkdir -p $(DESTDIR)$(CONFDIR)/plugins
+	cp monkeywrench/plugin-break*_ $(DESTDIR)$(LIBDIR)/plugins/
+	$(DESTDIR)$(SBINDIR)/munin-node-configure --suggest
 	echo 'Done?'
 
 t/install: 
@@ -407,12 +400,12 @@
 # can't seem to find a way to persuade it to write otherwhere.
 install-%: %/Build
 	cd $* && $(PERL) Build install			\
-            --install_path lib=$(PERLLIB)		\
-            --install_path bin=$(BINDIR)		\
-            --install_path script=$(BINDIR)		\
-            --install_path sbin=$(SBINDIR)		\
-            --install_path bindoc=$(MANDIR)/man1	\
-            --install_path libdoc=$(MANDIR)/man3	\
+            --install_path lib=$(DESTDIR)$(PERLLIB)		\
+            --install_path bin=$(DESTDIR)$(BINDIR)		\
+            --install_path script=$(DESTDIR)$(BINDIR)		\
+            --install_path sbin=$(DESTDIR)$(SBINDIR)		\
+            --install_path bindoc=$(DESTDIR)$(MANDIR)/man1	\
+            --install_path libdoc=$(DESTDIR)$(MANDIR)/man3	\
 
 test-%: %/Build
 	cd $* && $(PERL) Build test || true
