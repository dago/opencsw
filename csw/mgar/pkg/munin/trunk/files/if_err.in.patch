From 74d1fa95cd376e87824fd1bca3cad196adeabf1f Mon Sep 17 00:00:00 2001
From: Juergen Arndt <ja@opencsw.org>
Date: Sun, 26 Sep 2010 17:15:57 +0200
Subject: [PATCH] added support for Solaris 10

---
 plugins/node.d.sunos/if_err_.in |   27 +++++++++++++++++++++------
 1 files changed, 21 insertions(+), 6 deletions(-)

diff --git a/plugins/node.d.sunos/if_err_.in b/plugins/node.d.sunos/if_err_.in
index 097ec1c..269e9d3 100755
--- a/plugins/node.d.sunos/if_err_.in
+++ b/plugins/node.d.sunos/if_err_.in
@@ -42,6 +42,7 @@ Unknown license
 
 . $MUNIN_LIBDIR/plugins/plugin.sh
 
+SOLVERSION=`uname -r | awk -F. '{print $2}`
 INTERFACE=${0##*/if_err_}
 
 if [ "$1" = "autoconf" ]; then
@@ -56,7 +57,11 @@ fi
 
 if [ "$1" = "suggest" ]; then
 	if [ -x /usr/bin/kstat ]; then
-		kstat -m link -p -s '/^ierrors$/' | awk -F: '{ print $3 }'
+		if [ $SOLVERSION -le 10 ]; then
+			kstat -p -s '/^ierrors$/' | awk -F: '{ print $3 }'
+		elif [ $SOLVERSION -gt 10 ]; then
+			kstat -m link -p -s '/^ierrors$/' | awk -F: '{ print $3 }'
+		fi
 		exit 0
 	else
 		exit 1
@@ -88,8 +93,18 @@ if [ "$1" = "config" ]; then
 	exit 0
 fi;
 
-kstat -p -n $INTERFACE -m link -s '/^([io]errors|collisions)$/' | awk -F: '
-{
-	split($4, four, "\t")
-	print four[1] ".value", four[2]
-}'
+if [ $SOLVERSION -le 10 ]       # Solaris 10 and earlier
+then
+	kstat -p -n $INTERFACE -s '/^([io]errors|collisions)$/' | awk -F: '
+	{
+		split($4, four, "\t")
+		print four[1] ".value", four[2]
+	}'
+elif [ $SOLVERSION -eq 11 ]     # later than Solaris 10
+then
+	kstat -p -n $INTERFACE -m link -s '/^([io]errors|collisions)$/' | awk -F: '
+	{
+		split($4, four, "\t")
+		print four[1] ".value", four[2]
+	}'
+fi
-- 
1.7.2.2

