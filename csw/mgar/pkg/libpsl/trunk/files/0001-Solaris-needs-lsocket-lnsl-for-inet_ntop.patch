From 8315319044b92330fb9ce0c9fd78a97892e9d024 Mon Sep 17 00:00:00 2001
From: Dagobert Michelsen <dam@opencsw.org>
Date: Tue, 20 Jan 2015 20:21:55 +0100
Subject: [PATCH] Solaris needs -lsocket -lnsl for inet_ntop

---
 configure.ac | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/configure.ac b/configure.ac
index da9936c..af6525c 100644
--- a/configure.ac
+++ b/configure.ac
@@ -28,6 +28,9 @@ GTK_DOC_CHECK([1.15],[--flavour no-tmpl])
 ],[
 AM_CONDITIONAL([ENABLE_GTK_DOC], false)
 ])
+m4_ifdef([GTK_DOC_USE_LIBTOOL], [], [
+AM_CONDITIONAL([GTK_DOC_USE_LIBTOOL], false)
+])
 
 #
 # enable creation of man pages
@@ -171,6 +174,19 @@ AM_CONDITIONAL([BUILTIN_GENERATOR_LIBIDN2], test "x$enable_builtin" = "xlibidn2"
 AM_CONDITIONAL([BUILTIN_GENERATOR_LIBIDN], test "x$enable_builtin" = "xlibidn")
 AM_CONDITIONAL([WITH_BUILTIN], test $enable_builtin = yes)
 
+# Solaris has socket in libsocket and inet_ntop in libnsl, but also needs libsocket, so the order is important here
+AC_CHECK_LIB([socket], [socket], [NEEDS_SOCKET=yes], [])
+if test -n "$NEEDS_SOCKET" ; then
+  AC_CHECK_LIB([nsl], [inet_ntop], [NEEDS_NSL=yes], [])
+fi
+if test -n "$NEEDS_SOCKET" && test -n "$NEEDS_NSL" ; then
+  LIBS="$LIBS -lsocket -lnsl"
+elif test -n "$NEEDS_SOCKET" ; then
+  LIBS="$LIBS -lsocket"
+elif test -n "$NEEDS_NSL" ; then
+  LIBS="$LIBS -lnsl"
+fi
+
 # Check for valgrind
 ac_enable_valgrind=no
 AC_ARG_ENABLE(valgrind-tests,
-- 
2.2.1

