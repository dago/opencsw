From 0320b16973a5858f709c75f6232d6c68a347e528 Mon Sep 17 00:00:00 2001
From: Peter Felecan <pfelecan@opencsw.org>
Date: Wed, 14 Aug 2013 12:01:19 +0200
Subject: [PATCH] missing symbol ps_lgetxregsize

Patch set from http://sourceware.org/bugzilla/show_bug.cgi?id=15420%3E
signaled by Ralph Boehme
Fix issue reported at https://www.opencsw.org/mantis/view.php?id=5101
---
 gdb/ChangeLog    |  9 +++++++++
 gdb/configure    |  7 -------
 gdb/configure.ac |  7 -------
 gdb/sol-thread.c | 24 ++++++++++++++++++++++++
 4 files changed, 33 insertions(+), 14 deletions(-)

diff --git a/gdb/ChangeLog b/gdb/ChangeLog
index c9e1b3d..98d7e13 100644
--- a/gdb/ChangeLog
+++ b/gdb/ChangeLog
@@ -1,3 +1,12 @@
+2013-05-10  Joel Brobecker  <brobecker@adacore.com>
+
+	PR tdep/15420:
+	* sol-thread.c (ps_lgetxregsize, ps_lgetxregs, ps_lsetxregs):
+	New functions, directly copied from sparc-sol-thread.c.
+	* sparc-sol-thread.c: Delete.
+	* configure.ac: Remove code handling sparc-solaris-thread.c.
+	* configure: Regenerate.
+
 2013-04-26  Joel Brobecker  <brobecker@adacore.com>
 
 	* NEWS: Change "since GDB 7.5" into "in GDB 7.6".
diff --git a/gdb/configure b/gdb/configure
index b6ad59c..5ac0a23 100755
--- a/gdb/configure
+++ b/gdb/configure
@@ -11949,13 +11949,6 @@ $as_echo "#define HAVE_THREAD_DB_LIB 1" >>confdefs.h
 
          CONFIG_OBS="${CONFIG_OBS} sol-thread.o"
          CONFIG_SRCS="${CONFIG_SRCS} sol-thread.c"
-         # On SPARC CPUs, we also need to build sparc-sol-thread.
-         case ${host_cpu} in
-           sparc*)
-             CONFIG_OBS="${CONFIG_OBS} sparc-sol-thread.o"
-             CONFIG_SRCS="${CONFIG_SRCS} sparc-sol-thread.c"
-             ;;
-         esac
          { $as_echo "$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl" >&5
 $as_echo_n "checking for dlopen in -ldl... " >&6; }
 if test "${ac_cv_lib_dl_dlopen+set}" = set; then :
diff --git a/gdb/configure.ac b/gdb/configure.ac
index e733d9d..e7ce71b 100644
--- a/gdb/configure.ac
+++ b/gdb/configure.ac
@@ -1733,13 +1733,6 @@ if test ${build} = ${host} -a ${host} = ${target} ; then
          [Define if using Solaris thread debugging.])
          CONFIG_OBS="${CONFIG_OBS} sol-thread.o"
          CONFIG_SRCS="${CONFIG_SRCS} sol-thread.c"
-         # On SPARC CPUs, we also need to build sparc-sol-thread.
-         case ${host_cpu} in
-           sparc*)
-             CONFIG_OBS="${CONFIG_OBS} sparc-sol-thread.o"
-             CONFIG_SRCS="${CONFIG_SRCS} sparc-sol-thread.c"
-             ;;
-         esac
          AC_CHECK_LIB(dl, dlopen)
 	 CONFIG_LDFLAGS="${CONFIG_LDFLAGS} $RDYNAMIC"
 	 # Sun randomly tweaked the prototypes in <proc_service.h>
diff --git a/gdb/sol-thread.c b/gdb/sol-thread.c
index ec3df83..7bb0864 100644
--- a/gdb/sol-thread.c
+++ b/gdb/sol-thread.c
@@ -907,6 +907,30 @@ ps_plog (const char *fmt, ...)
   vfprintf_filtered (gdb_stderr, fmt, args);
 }
 
+/* Get size of extra register set.  Currently a noop.  */
+
+ps_err_e
+ps_lgetxregsize (gdb_ps_prochandle_t ph, lwpid_t lwpid, int *xregsize)
+{
+  return PS_OK;
+}
+
+/* Get extra register set.  Currently a noop.  */
+
+ps_err_e
+ps_lgetxregs (gdb_ps_prochandle_t ph, lwpid_t lwpid, caddr_t xregset)
+{
+  return PS_OK;
+}
+
+/* Set extra register set.  Currently a noop.  */
+
+ps_err_e
+ps_lsetxregs (gdb_ps_prochandle_t ph, lwpid_t lwpid, caddr_t xregset)
+{
+  return PS_OK;
+}
+
 /* Get floating-point registers for LWP.  */
 
 ps_err_e
-- 
1.8.3.4

