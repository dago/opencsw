From 0e4f7bfaa59526be55156b3fae29fc1f46c6caae Mon Sep 17 00:00:00 2001
From: Dagobert Michelsen <dam@opencsw.org>
Date: Wed, 6 Jul 2011 10:48:32 +0200
Subject: [PATCH] Add headers and libs as required to testsuite

---
 test/Makefile.am        |    2 +-
 test/Makefile.in        |   14 +++++--
 test/mp4broadcaster     |   99 +++++++++++++++++++++++++++++++++++++++++++++++
 test/mp4broadcaster.cpp |    2 +
 4 files changed, 112 insertions(+), 5 deletions(-)
 create mode 100755 test/mp4broadcaster

diff --git a/test/Makefile.am b/test/Makefile.am
index 14e1604..86ece8e 100644
--- a/test/Makefile.am
+++ b/test/Makefile.am
@@ -7,7 +7,7 @@ c_api_SOURCES = c_api.c
 c_api_LDADD = $(top_builddir)/libmp4v2.la -lstdc++
 
 mp4broadcaster_SOURCES = mp4broadcaster.cpp
-mp4broadcaster_LDADD = $(top_builddir)/libmp4v2.la
+mp4broadcaster_LDADD = $(top_builddir)/libmp4v2.la -lsocket -lnsl -lresolv
 
 nullcreate_SOURCES = nullcreate.cpp
 nullcreate_LDADD = $(top_builddir)/libmp4v2.la
diff --git a/test/Makefile.in b/test/Makefile.in
index 1d553c6..e2bde38 100644
--- a/test/Makefile.in
+++ b/test/Makefile.in
@@ -122,6 +122,7 @@ EGREP = @EGREP@
 EXEEXT = @EXEEXT@
 F77 = @F77@
 FFLAGS = @FFLAGS@
+GREP = @GREP@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
@@ -139,6 +140,7 @@ PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
 PACKAGE_NAME = @PACKAGE_NAME@
 PACKAGE_STRING = @PACKAGE_STRING@
 PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
 PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
@@ -146,12 +148,9 @@ SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 STRIP = @STRIP@
 VERSION = @VERSION@
-ac_ct_AR = @ac_ct_AR@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-ac_ct_RANLIB = @ac_ct_RANLIB@
-ac_ct_STRIP = @ac_ct_STRIP@
 am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
 am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
 am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
@@ -168,23 +167,30 @@ build_cpu = @build_cpu@
 build_os = @build_os@
 build_vendor = @build_vendor@
 datadir = @datadir@
+datarootdir = @datarootdir@
+docdir = @docdir@
+dvidir = @dvidir@
 exec_prefix = @exec_prefix@
 host = @host@
 host_alias = @host_alias@
 host_cpu = @host_cpu@
 host_os = @host_os@
 host_vendor = @host_vendor@
+htmldir = @htmldir@
 includedir = @includedir@
 infodir = @infodir@
 install_sh = @install_sh@
 libdir = @libdir@
 libexecdir = @libexecdir@
+localedir = @localedir@
 localstatedir = @localstatedir@
 mandir = @mandir@
 mkdir_p = @mkdir_p@
 oldincludedir = @oldincludedir@
+pdfdir = @pdfdir@
 prefix = @prefix@
 program_transform_name = @program_transform_name@
+psdir = @psdir@
 sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
@@ -193,7 +199,7 @@ INCLUDES = -I$(top_srcdir) -I$(top_srcdir)/util
 c_api_SOURCES = c_api.c
 c_api_LDADD = $(top_builddir)/libmp4v2.la -lstdc++
 mp4broadcaster_SOURCES = mp4broadcaster.cpp
-mp4broadcaster_LDADD = $(top_builddir)/libmp4v2.la
+mp4broadcaster_LDADD = $(top_builddir)/libmp4v2.la -lsocket -lnsl -lresolv
 nullcreate_SOURCES = nullcreate.cpp
 nullcreate_LDADD = $(top_builddir)/libmp4v2.la
 nullvplayer_SOURCES = nullvplayer.cpp
diff --git a/test/mp4broadcaster b/test/mp4broadcaster
new file mode 100755
index 0000000..df62aa1
--- /dev/null
+++ b/test/mp4broadcaster
@@ -0,0 +1,99 @@
+#! /bin/bash
+
+# mp4broadcaster - temporary wrapper script for .libs/mp4broadcaster
+# Generated by ltmain.sh - GNU libtool 1.5.22 (1.1220.2.365 2005/12/18 22:14:06)
+#
+# The mp4broadcaster program cannot be directly executed until all the libtool
+# libraries that it depends on are installed.
+#
+# This wrapper script should never be moved out of the build directory.
+# If it is, it will not operate correctly.
+
+# Sed substitution that helps us do robust quoting.  It backslashifies
+# metacharacters that are still active within double-quoted strings.
+Xsed='/opt/csw/bin/gsed -e 1s/^X//'
+sed_quote_subst='s/\([\\`\\"$\\\\]\)/\\\1/g'
+
+# The HP-UX ksh and POSIX shell print the target directory to stdout
+# if CDPATH is set.
+(unset CDPATH) >/dev/null 2>&1 && unset CDPATH
+
+relink_command=""
+
+# This environment variable determines our operation mode.
+if test "$libtool_install_magic" = "%%%MAGIC variable%%%"; then
+  # install mode needs the following variable:
+  notinst_deplibs=' ../libmp4v2.la'
+else
+  # When we are sourced in execute mode, $file and $echo are already set.
+  if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+    echo="echo"
+    file="$0"
+    # Make sure echo works.
+    if test "X$1" = X--no-reexec; then
+      # Discard the --no-reexec flag, and continue.
+      shift
+    elif test "X`($echo '\t') 2>/dev/null`" = 'X\t'; then
+      # Yippee, $echo works!
+      :
+    else
+      # Restart under the correct shell, and then maybe $echo will work.
+      exec /bin/bash "$0" --no-reexec ${1+"$@"}
+    fi
+  fi
+
+  # Find the directory that this script lives in.
+  thisdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+  test "x$thisdir" = "x$file" && thisdir=.
+
+  # Follow symbolic links until we get to the real thisdir.
+  file=`ls -ld "$file" | /opt/csw/bin/gsed -n 's/.*-> //p'`
+  while test -n "$file"; do
+    destdir=`$echo "X$file" | $Xsed -e 's%/[^/]*$%%'`
+
+    # If there was a directory component, then change thisdir.
+    if test "x$destdir" != "x$file"; then
+      case "$destdir" in
+      [\\/]* | [A-Za-z]:[\\/]*) thisdir="$destdir" ;;
+      *) thisdir="$thisdir/$destdir" ;;
+      esac
+    fi
+
+    file=`$echo "X$file" | $Xsed -e 's%^.*/%%'`
+    file=`ls -ld "$thisdir/$file" | /opt/csw/bin/gsed -n 's/.*-> //p'`
+  done
+
+  # Try to get the absolute directory name.
+  absdir=`cd "$thisdir" && pwd`
+  test -n "$absdir" && thisdir="$absdir"
+
+  program='mp4broadcaster'
+  progdir="$thisdir/.libs"
+
+
+  if test -f "$progdir/$program"; then
+    # Add our own library path to LD_LIBRARY_PATH
+    LD_LIBRARY_PATH="/home/dam/mgar/pkg/libmp4v2/trunk/work/solaris9-sparc/build-isa-sparcv8/libmp4v2-1.5.0.1/.libs:$LD_LIBRARY_PATH"
+
+    # Some systems cannot cope with colon-terminated LD_LIBRARY_PATH
+    # The second colon is a workaround for a bug in BeOS R4 sed
+    LD_LIBRARY_PATH=`$echo "X$LD_LIBRARY_PATH" | $Xsed -e 's/::*$//'`
+
+    export LD_LIBRARY_PATH
+
+    if test "$libtool_execute_magic" != "%%%MAGIC variable%%%"; then
+      # Run the actual program with our arguments.
+
+      exec "$progdir/$program" ${1+"$@"}
+
+      $echo "$0: cannot exec $program ${1+"$@"}"
+      exit 1
+    fi
+  else
+    # The program doesn't exist.
+    $echo "$0: error: \`$progdir/$program' does not exist" 1>&2
+    $echo "This script is just a wrapper for $program." 1>&2
+    echo "See the libtool documentation for more information." 1>&2
+    exit 1
+  fi
+fi
diff --git a/test/mp4broadcaster.cpp b/test/mp4broadcaster.cpp
index 38b4c9c..8a8cee9 100644
--- a/test/mp4broadcaster.cpp
+++ b/test/mp4broadcaster.cpp
@@ -21,6 +21,8 @@
 
 #include "mpeg4ip.h"
 #include <arpa/inet.h>
+#include <sys/types.h>
+#include <sys/socket.h>
 #include "mp4.h"
 
 // forward declarations
-- 
1.7.5.4

