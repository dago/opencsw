# $Id$
# TODO (release-critical prefixed with !, non release-critical with *)
#
NAME = fusioninventory-agent
VERSION = 2.2.7
GARTYPE = v2
CATEGORIES = cpan

DESCRIPTION = FusionInventory agent
define BLURB
  The FusionInventory agent is a generic management agent. It can perform a
  certain number of tasks, according to its own execution plan, or on behalf of
  a GLPI server with fusioninventory plugin, acting as a control point.
endef

MASTER_SITES = $(CPAN_MIRRORS)
AUTHOR = FUSINV
MODDIST =
DISTNAME = FusionInventory-Agent-$(VERSION)
DISTFILES = $(DISTNAME).tar.gz
DISTFILES += fusioninventory-agent.cron
DISTFILES += fusioninventory-agent.default

UPSTREAM_MASTER_SITES = http://forge.fusioninventory.org/projects/fusioninventory-agent/files

LICENSE = LICENSE

PACKAGES = CSWfusioninventory-agent
ARCHALL = 1

RUNTIME_DEP_PKGS += CSWpm-file-which
RUNTIME_DEP_PKGS += CSWpm-io-socket-ssl
RUNTIME_DEP_PKGS += CSWpm-libwww-perl
RUNTIME_DEP_PKGS += CSWpm-proc-daemon
RUNTIME_DEP_PKGS += CSWpm-proc-pid-file
# not available in 5.9
ifneq ($(shell /usr/bin/uname -r),5.9) 
    RUNTIME_DEP_PKGS += CSWpm-net-cups
endif
RUNTIME_DEP_PKGS += CSWpm-net-ip
RUNTIME_DEP_PKGS += CSWpm-text-template
RUNTIME_DEP_PKGS += CSWpm-universal-require
RUNTIME_DEP_PKGS += CSWpm-xml-treepp
RUNTIME_DEP_PKGS += CSWmemconf
PATCHFILES += 0001-don-t-install-a-private-memconf-copy.patch

CONFIGURE_ARGS = PREFIX=/opt/csw SYSCONFDIR=/etc/opt/csw/fusioninventory LOCALSTATEDIR=/var/opt/csw/fusioninventory

# skip tests
SKIPTEST ?= 1

# ensure usage of gnu coreutils install
INSTALL_ENV_PATH = /opt/csw/gnu:$(PATH)

# checkpkg overrides
CHECKPKG_OVERRIDES += archall-with-arch-paths|/opt/csw/share/fusioninventory/lib/FusionInventory/Agent/Task/Inventory/Input/BSD/Archs/i386.pm
CHECKPKG_OVERRIDES += archall-with-arch-paths|/opt/csw/share/fusioninventory/lib/FusionInventory/Agent/Task/Inventory/Input/Linux/Archs/i386.pm
CHECKPKG_OVERRIDES += file-with-bad-content|/usr/local|root/opt/csw/share/fusioninventory/lib/FusionInventory/Agent/Task/Inventory.pm
CHECKPKG_OVERRIDES += surplus-dependency|CSWperl

DOCLIST = LICENSE Changes README THANKS

CRONTABS = /etc/opt/csw/pkg/CSWfusioninventory-agent/crontabs/root

post-install-modulated:
	/opt/csw/gnu/install -D -m 644 $(WORKDIR)/fusioninventory-agent.cron $(DESTDIR)/etc/opt/csw/pkg/CSWfusioninventory-agent/crontabs/root
	/opt/csw/gnu/install -D -m 644 $(WORKDIR)/fusioninventory-agent.default $(DESTDIR)/etc/opt/csw/default/fusioninventory-agent

include gar/category.mk
