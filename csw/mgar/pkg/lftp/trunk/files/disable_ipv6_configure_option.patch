--- lftp-4.3.1.orig/m4/sockpfaf.m4	Wed Mar 16 10:06:17 2011
+++ lftp-4.3.1/m4/sockpfaf.m4	Tue Jul 19 00:57:52 2011
@@ -36,6 +36,12 @@
     AC_DEFINE([HAVE_IPV4], [1], [Define to 1 if <sys/socket.h> defines AF_INET.])
   fi
 
+  AC_ARG_ENABLE([ipv6],
+   AS_HELP_STRING([--disable-ipv6], [disable ipv6 support]),
+   [ enable_ipv6=$enableval; ],
+   [ enable_ipv6=; ])    
+
+if test x$enable_ipv6 != xno; then
   AC_MSG_CHECKING([for IPv6 sockets])
   AC_CACHE_VAL([gl_cv_socket_ipv6],
     [AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <sys/types.h>
@@ -57,7 +63,10 @@
   AC_MSG_RESULT([$gl_cv_socket_ipv6])
   if test $gl_cv_socket_ipv6 = yes; then
     AC_DEFINE([HAVE_IPV6], [1], [Define to 1 if <sys/socket.h> defines AF_INET6.])
+  elif test x$enable_ipv6 = xyes; then
+    AC_MSG_ERROR(ipv6 support not available)
   fi
+fi
 ])
 
 AC_DEFUN([gl_SOCKET_FAMILY_UNIX],
--- lftp-4.3.1.orig/configure.ac	Fri Jun 24 17:34:51 2011
+++ lftp-4.3.1/configure.ac.new	Tue Jul 19 16:19:22 2011
@@ -473,7 +473,7 @@
 # endif
 #endif
 
-#define INET6 (defined(AF_INET6) \
+#define INET6 (defined(HAVE_IPV6) \
 	       && defined(HAVE_GETNAMEINFO) \
 	       && defined(HAVE_GETADDRINFO))
 
--- a/src/Torrent.cc
+++ b/src/Torrent.cc
@@ -482,6 +482,7 @@ int TorrentTracker::HandleTrackerReply()
       }
       LogNote(4,plural("Received valid info about %d peer$|s$",peers_count),peers_count);
    }
+#if INET6
    peers_count=0;
    b_peers=reply->dict.lookup("peers6");
    if(b_peers && b_peers->type==BeNode::BE_STR) { // binary model
@@ -499,6 +500,7 @@ int TorrentTracker::HandleTrackerReply()
       }
       LogNote(4,plural("Received valid info about %d IPv6 peer$|s$",peers_count),peers_count);
    }
+#endif
    tracker_timer.Reset();
    tracker_reply=0;
    return MOVED;
