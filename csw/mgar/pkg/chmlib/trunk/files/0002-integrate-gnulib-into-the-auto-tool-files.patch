From 104d8b5f3922d2b620fc4f0ac306bf59110766e2 Mon Sep 17 00:00:00 2001
From: Ben Walton <bwalton@opencsw.org>
Date: Tue, 10 Nov 2009 02:43:57 +0100
Subject: [PATCH 2/4] integrate gnulib into the auto* tool files

Signed-off-by: Ben Walton <bwalton@opencsw.org>
---
 Makefile.am     |    3 ++-
 configure.in    |    6 +++++-
 src/Makefile.am |   12 +++++++-----
 3 files changed, 14 insertions(+), 7 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 3150987..c93ee4d 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,3 +1,4 @@
 AUTOMAKE_OPTIONS=1.6 dist-bzip2 dist-zip
-SUBDIRS=src
+SUBDIRS=gnulib src
 EXTRA_DIST=ChmLib-ce.zip ChmLib-ds6.zip contrib
+ACLOCAL_AMFLAGS=-I gnulib/m4
diff --git a/configure.in b/configure.in
index b39413a..14c4b8a 100644
--- a/configure.in
+++ b/configure.in
@@ -8,6 +8,8 @@ AM_MAINTAINER_MODE
 
 dnl Checks for programs.
 AC_PROG_CC
+gl_EARLY
+gl_INIT
 AC_PROG_LD
 AM_PROG_LIBTOOL
 AC_PROG_INSTALL
@@ -186,4 +188,6 @@ dnl top_builddir=`pwd`
 dnl AC_SUBST(top_builddir)
 
 dnl AC_OUTPUT_COMMANDS([if test ! -d src; then mkdir src; fi])
-AC_OUTPUT([Makefile src/Makefile])
+AC_CONFIG_FILES([Makefile gnulib/Makefile src/Makefile])
+AC_OUTPUT
+
diff --git a/src/Makefile.am b/src/Makefile.am
index ab67822..12a2ab5 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -1,3 +1,5 @@
+AM_CPPFLAGS = -I$(top_builddir)/gnulib -I$(top_srcdir)/gnulib
+
 lib_LTLIBRARIES=libchm.la
 libchm_la_SOURCES=chm_lib.c lzx.c
 include_HEADERS=chm_lib.h lzx.h
@@ -5,13 +7,13 @@ include_HEADERS=chm_lib.h lzx.h
 if EXAMPLES
 bin_PROGRAMS=chm_http enum_chmLib enumdir_chmLib extract_chmLib test_chmLib
 enum_chmLib_SOURCES=enum_chmLib.c
-enum_chmLib_LDADD=libchm.la
+enum_chmLib_LDADD=libchm.la $(top_srcdir)/gnulib/libgnu.la
 chm_http_SOURCES=chm_http.c
-chm_http_LDADD=libchm.la
+chm_http_LDADD=libchm.la $(top_srcdir)/gnulib/libgnu.la
 enumdir_chmLib_SOURCES=enumdir_chmLib.c
-enumdir_chmLib_LDADD=libchm.la
+enumdir_chmLib_LDADD=libchm.la $(top_srcdir)/gnulib/libgnu.la
 extract_chmLib_SOURCES=extract_chmLib.c
-extract_chmLib_LDADD=libchm.la
+extract_chmLib_LDADD=libchm.la $(top_srcdir)/gnulib/libgnu.la
 test_chmLib_SOURCES=test_chmLib.c
-test_chmLib_LDADD=libchm.la
+test_chmLib_LDADD=libchm.la $(top_srcdir)/gnulib/libgnu.la
 endif ##EXAMPLES
-- 
1.6.5.1

