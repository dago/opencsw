From 8ed03d015459dbffa371f3a11e348e680ce99d74 Mon Sep 17 00:00:00 2001
From: Dagobert Michelsen <dam@opencsw.org>
Date: Fri, 12 Aug 2011 18:27:01 +0200
Subject: [PATCH] Shield functions not available on Solaris 9, autoconf
 detection still missing

---
 libexplain/buffer/errno/strtof.c  |    2 ++
 libexplain/buffer/errno/strtold.c |    2 ++
 libexplain/mkdtemp_on_error.c     |    5 +++++
 libexplain/setenv_on_error.c      |    5 +++++
 libexplain/strtof_on_error.c      |    5 +++++
 libexplain/strtold_on_error.c     |    5 +++++
 libexplain/unsetenv_on_error.c    |    5 +++++
 7 files changed, 29 insertions(+), 0 deletions(-)

diff --git a/libexplain/buffer/errno/strtof.c b/libexplain/buffer/errno/strtof.c
index 004a1cc..bab13ad 100644
--- a/libexplain/buffer/errno/strtof.c
+++ b/libexplain/buffer/errno/strtof.c
@@ -73,7 +73,9 @@ explain_buffer_errno_strtof_explanation(explain_string_buffer_t *sb, int errnum,
              */
             ep = 0;
             err = errno;
+#ifdef HAVE_STRTOF
             n = strtof(nptr, &ep);
+#endif
             errno = err;
             if (ep == nptr)
             {
diff --git a/libexplain/buffer/errno/strtold.c b/libexplain/buffer/errno/strtold.c
index e252f4d..36deb41 100644
--- a/libexplain/buffer/errno/strtold.c
+++ b/libexplain/buffer/errno/strtold.c
@@ -73,7 +73,9 @@ explain_buffer_errno_strtold_explanation(explain_string_buffer_t *sb,
              */
             ep = 0;
             err = errno;
+#ifdef HAVE_STRTOLD
             n = strtold(nptr, &ep);
+#endif          
             errno = err;
             if (ep == nptr)
             {
diff --git a/libexplain/mkdtemp_on_error.c b/libexplain/mkdtemp_on_error.c
index 1ce05ac..81dc2ff 100644
--- a/libexplain/mkdtemp_on_error.c
+++ b/libexplain/mkdtemp_on_error.c
@@ -29,7 +29,12 @@ explain_mkdtemp_on_error(char *pathname)
 {
     char            *result;
 
+#ifdef HAVE_MKDTEMP
     result = mkdtemp(pathname);
+#else
+    errno = ENOSYS;
+    result = -1;
+#endif
     if (!result)
     {
         int             hold_errno;
diff --git a/libexplain/setenv_on_error.c b/libexplain/setenv_on_error.c
index c1d3fb9..a367364 100644
--- a/libexplain/setenv_on_error.c
+++ b/libexplain/setenv_on_error.c
@@ -29,7 +29,12 @@ explain_setenv_on_error(const char *name, const char *value, int overwrite)
 {
     int             result;
 
+#ifdef HAVE_SETENV
     result = setenv(name, value, overwrite);
+#else
+    errno = ENOSYS;
+    result = -1;
+#endif
     if (result < 0)
     {
         int             hold_errno;
diff --git a/libexplain/strtof_on_error.c b/libexplain/strtof_on_error.c
index e2c35f9..e7d2eaf 100644
--- a/libexplain/strtof_on_error.c
+++ b/libexplain/strtof_on_error.c
@@ -34,7 +34,12 @@ explain_strtof_on_error(const char *nptr, char **endptr)
     hold_errno = errno;
     dummy = 0;
     errno = 0;
+#ifdef HAVE_STRTOF
     result = strtof(nptr, endptr ? endptr : &dummy);
+#else
+    errno = ENOSYS;
+    result = -1;
+#endif
     if (errno == 0 && (endptr ? *endptr : dummy) == nptr)
     {
         /*
diff --git a/libexplain/strtold_on_error.c b/libexplain/strtold_on_error.c
index 3a5ce0f..7debe2a 100644
--- a/libexplain/strtold_on_error.c
+++ b/libexplain/strtold_on_error.c
@@ -34,7 +34,12 @@ explain_strtold_on_error(const char *nptr, char **endptr)
     hold_errno = errno;
     dummy = 0;
     errno = 0;
+#ifdef HAVE_STRTOLD
     result = strtold(nptr, endptr ? endptr : &dummy);
+#else
+    errno = ENOSYS;
+    result = -1;
+#endif
     if (errno == 0 && (endptr ? *endptr : dummy) == nptr)
     {
         /*
diff --git a/libexplain/unsetenv_on_error.c b/libexplain/unsetenv_on_error.c
index d0258ed..77adbbc 100644
--- a/libexplain/unsetenv_on_error.c
+++ b/libexplain/unsetenv_on_error.c
@@ -29,7 +29,12 @@ explain_unsetenv_on_error(const char *name)
 {
     int             result;
 
+#ifdef HAVE_UNSETENV
     result = unsetenv(name);
+#else
+    errno = ENOSYS;
+    result = -1;
+#endif
     if (result < 0)
     {
         int             hold_errno;
-- 
1.7.5.4

