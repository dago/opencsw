From b60fa77597ce86a19c9fc45b658e193498956268 Mon Sep 17 00:00:00 2001
From: Dagobert Michelsen <dam@opencsw.org>
Date: Wed, 12 May 2010 14:39:14 +0200
Subject: [PATCH 3/3] Add definitions for CMSG_SPACE

---
 compat/imsg-buffer.c    |    1 +
 compat/imsg.c           |    1 +
 compat/solaris-compat.h |   21 +++++++++++++++++++++
 3 files changed, 23 insertions(+), 0 deletions(-)
 create mode 100644 compat/solaris-compat.h

diff --git a/compat/imsg-buffer.c b/compat/imsg-buffer.c
index 7baaa42..8da71f8 100644
--- a/compat/imsg-buffer.c
+++ b/compat/imsg-buffer.c
@@ -27,6 +27,7 @@
 #include <unistd.h>
 
 #include "tmux.h"
+#include "compat/solaris-compat.h"
 
 int	buf_realloc(struct buf *, size_t);
 void	buf_enqueue(struct msgbuf *, struct buf *);
diff --git a/compat/imsg.c b/compat/imsg.c
index 1bc6062..f209fe0 100644
--- a/compat/imsg.c
+++ b/compat/imsg.c
@@ -27,6 +27,7 @@
 #include <unistd.h>
 
 #include "tmux.h"
+#include "compat/solaris-compat.h"
 
 int	 imsg_get_fd(struct imsgbuf *);
 
diff --git a/compat/solaris-compat.h b/compat/solaris-compat.h
new file mode 100644
index 0000000..57bbb51
--- /dev/null
+++ b/compat/solaris-compat.h
@@ -0,0 +1,21 @@
+/*
+ * CMS_SPACE etc. definitions for Solaris from
+ *   http://mailman.videolan.org/pipermail/vlc-devel/2006-May/024402.html
+ */
+
+#ifndef CMSG_ALIGN
+#   ifdef __sun__
+#       define CMSG_ALIGN _CMSG_DATA_ALIGN
+#   else
+#       define CMSG_ALIGN(len) (((len)+sizeof(long)-1) & ~(sizeof(long)-1))
+#   endif
+#endif
+
+#ifndef CMSG_SPACE
+#   define CMSG_SPACE(len) (CMSG_ALIGN(sizeof(struct cmsghdr))+CMSG_ALIGN(len))
+#endif
+
+#ifndef CMSG_LEN
+#   define CMSG_LEN(len) (CMSG_ALIGN(sizeof(struct cmsghdr))+(len))
+#endif
+
-- 
1.7.0

