#!/bin/bash

cat <<EOF
#!/bin/sh

PIR=\${PKG_INSTALL_ROOT:-/}
AP2_DIR=\$PIR/opt/csw/apache2
AP2_CONF=\$AP2_DIR/etc/

CONF_FILE=\$AP2_CONF/$1

if [ "\$1" = install ]; then
   if [ ! -f "\$CONF_FILE" ]; then
      cp -p \$CONF_FILE.CSW \$CONF_FILE
      perl -pi \
	-e "s/#*ServerName.*www.example.com/ServerName \`hostname\`/;" \
	-e "s/#*ServerAdmin you\@example.com/ServerAdmin root@\`hostname\`/;" \
	-e "s/^User.*daemon/User nobody/;" \
	-e "s/^Group.*daemon/Group nobody/;" \
	-e 's/^(LoadModule.*suexec.*)/#\$1/;' \
	-e 's/^#(Include.*httpd-mpm.conf)/\$1/;' \
	-e 's/^#(Include.*httpd-ssl.conf)/\$1/;' \$CONF_FILE
   fi
else
   # preserve ourselves with no changes
   cat \$CONF_FILE
fi
EOF
