From c426b27d2b6a35acafc157182c21f15ebcb97a69 Mon Sep 17 00:00:00 2001
From: Ben Walton <bwalton@opencsw.org>
Date: Sun, 31 Oct 2010 02:43:48 +0100
Subject: [PATCH] Force ld to embed the proper SONAME for libruby

Set LIBRUBY_DLDFLAGS in the solaris section of the configure script
in order to force ld to pass the appropriate -h when building libruby.

Signed-off-by: Ben Walton <bwalton@opencsw.org>
---
 configure |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/configure b/configure
index 0badcbd..5753333 100755
--- a/configure
+++ b/configure
@@ -10696,6 +10696,7 @@ if test "$enable_shared" = 'yes'; then
 	SOLIBS='$(LIBS)'
 	LIBRUBY_SO='lib$(RUBY_SO_NAME).so.$(MAJOR)'
 	LIBRUBY_ALIASES='lib$(RUBY_SO_NAME).so.$(MAJOR).$(MINOR).$(TEENY) lib$(RUBY_SO_NAME).so'
+	LIBRUBY_DLDFLAGS="-h ${LIBRUBY_SO}"
 	if test "$GCC" = yes; then
 	    LIBRUBY_DLDFLAGS="$DLDFLAGS "'-Wl,-h,$(@F)'
 	fi
-- 
1.7.3

